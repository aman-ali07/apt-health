#!/usr/bin/env bash
set -e

# Handle upgrade vs fresh install
if [ "$1" = "configure" ]; then
  # Create configuration directory
  install -d -m 0755 /etc/apt-health

  # Create log file if it doesn't exist, with secure permissions
  if [ ! -f /var/log/apt-health.log ]; then
    touch /var/log/apt-health.log
    chmod 0640 /var/log/apt-health.log
    chown root:adm /var/log/apt-health.log 2>/dev/null || true
  else
    # Ensure existing log has secure permissions
    chmod 0640 /var/log/apt-health.log 2>/dev/null || true
    chown root:adm /var/log/apt-health.log 2>/dev/null || true
  fi
fi

exit 0
